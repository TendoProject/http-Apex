"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Runner = void 0;
const app = require("lib");
const ui = require("ui");
class Runner {
    constructor(canvas = document.getElementById('canvas'), map = new app.features.Map(canvas), radar = new app.features.Radar(canvas), recoil = new app.features.Recoil(), sense = new app.features.Sense()) {
        this.canvas = canvas;
        this.map = map;
        this.radar = radar;
        this.recoil = recoil;
        this.sense = sense;
    }
    static create() {
        const source = new Runner();
        source.attach();
        return source.run.bind(source);
    }
    run(core, vm) {
        const localPlayer = core.playerList.get(core.localPlayer.value);
        this.updateResearch(core, vm, localPlayer);
        this.updateSense(core, vm, localPlayer);
        this.canvas.height = window.innerHeight;
        this.canvas.width = window.innerWidth;
        this.update(core, vm, localPlayer);
    }
    attach() {
        this.canvas.addEventListener('dblclick', () => {
            (document.fullscreenElement
                ? document.exitFullscreen()
                : document.body.requestFullscreen()).catch();
        });
    }
    update(core, vm, localPlayer) {
        switch (vm.settings.general.viewType.value) {
            case ui.settings.general.MainType.Map:
                this.map.refresh(core.levelName.value);
                this.updateMap(core, vm, localPlayer);
                break;
            case ui.settings.general.MainType.Radar:
                this.radar.refresh();
                this.updateRadar(core, vm, localPlayer);
                break;
        }
    }
    updateMap(core, vm, localPlayer) {
        if (vm.settings.general.map.showItems.value)
            this.map.renderItems(core.itemList.values(), vm.settings.itemSet);
        if (vm.settings.general.map.showPlayers.value && localPlayer)
            this.map.renderPlayers(localPlayer, core.playerList.values());
    }
    updateRadar(core, vm, localPlayer) {
        if (vm.settings.general.radar.showItems.value && localPlayer)
            this.radar.renderItems(localPlayer, core.itemList.values(), vm.settings.itemSet);
        if (vm.settings.general.radar.showPlayers.value && localPlayer)
            this.radar.renderNpcs(localPlayer, core.npcList.values());
        if (vm.settings.general.radar.showPlayers.value && localPlayer)
            this.radar.renderPlayers(localPlayer, core.playerList.values());
    }
    updateResearch(core, vm, localPlayer) {
        if (vm.settings.research.recoil.enable.value && localPlayer && vm.settings.research.recoil.options)
            this.recoil.update(core.buttonList, localPlayer, vm.settings.research.recoil.options);
    }
    updateSense(core, vm, localPlayer) {
        const itemsFn = vm.settings.general.sense.highlightItems.value
            ? this.sense.updateItems.bind(this.sense)
            : this.sense.resetItems.bind(this.sense);
        const playersFn = vm.settings.general.sense.highlightPlayers.value
            ? this.sense.updatePlayers.bind(this.sense)
            : this.sense.resetPlayers.bind(this.sense);
        if (localPlayer) {
            itemsFn(localPlayer, core.itemList.values(), vm.settings.itemSet);
            playersFn(localPlayer, core.playerList.values());
        }
    }
}
exports.Runner = Runner;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUnVubmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1J1bm5lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQkFBMkI7QUFDM0IseUJBQXlCO0FBRXpCLE1BQWEsTUFBTTtJQUNqQixZQUNtQixTQUFTLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFzQixFQUMvRCxNQUFNLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQ2xDLFFBQVEsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFDdEMsU0FBUyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQ2xDLFFBQVEsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRTtRQUpoQyxXQUFNLEdBQU4sTUFBTSxDQUF5RDtRQUMvRCxRQUFHLEdBQUgsR0FBRyxDQUErQjtRQUNsQyxVQUFLLEdBQUwsS0FBSyxDQUFpQztRQUN0QyxXQUFNLEdBQU4sTUFBTSxDQUE0QjtRQUNsQyxVQUFLLEdBQUwsS0FBSyxDQUEyQjtJQUFHLENBQUM7SUFFdkQsTUFBTSxDQUFDLE1BQU07UUFDWCxNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNoQixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxHQUFHLENBQUMsSUFBbUIsRUFBRSxFQUFvQjtRQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsV0FB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SUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdDLElBQUksV0FBVyxFQUFFO1lBQ2YsT0FBTyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEUsU0FBUyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7U0FDbEQ7SUFDSCxDQUFDO0NBQ0Y7QUE3RUQsd0JBNkVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgYXBwIGZyb20gJ2xpYic7XG5pbXBvcnQgKiBhcyB1aSBmcm9tICd1aSc7XG5cbmV4cG9ydCBjbGFzcyBSdW5uZXIge1xuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpIGFzIEhUTUxDYW52YXNFbGVtZW50LFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWFwID0gbmV3IGFwcC5mZWF0dXJlcy5NYXAoY2FudmFzKSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJhZGFyID0gbmV3IGFwcC5mZWF0dXJlcy5SYWRhcihjYW52YXMpLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcmVjb2lsID0gbmV3IGFwcC5mZWF0dXJlcy5SZWNvaWwoKSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNlbnNlID0gbmV3IGFwcC5mZWF0dXJlcy5TZW5zZSgpKSB7fVxuICBcbiAgc3RhdGljIGNyZWF0ZSgpIHtcbiAgICBjb25zdCBzb3VyY2UgPSBuZXcgUnVubmVyKCk7XG4gICAgc291cmNlLmF0dGFjaCgpO1xuICAgIHJldHVybiBzb3VyY2UucnVuLmJpbmQoc291cmNlKTtcbiAgfVxuXG4gIHJ1bihjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCkge1xuICAgIGNvbnN0IGxvY2FsUGxheWVyID0gY29yZS5wbGF5ZXJMaXN0LmdldChjb3JlLmxvY2FsUGxheWVyLnZhbHVlKTtcbiAgICB0aGlzLnVwZGF0ZVJlc2VhcmNoKGNvcmUsIHZtLCBsb2NhbFBsYXllcik7XG4gICAgdGhpcy51cGRhdGVTZW5zZShjb3JlLCB2bSwgbG9jYWxQbGF5ZXIpO1xuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIHRoaXMudXBkYXRlKGNvcmUsIHZtLCBsb2NhbFBsYXllcik7XG4gIH1cblxuICBwcml2YXRlIGF0dGFjaCgpIHtcbiAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsICgpID0+IHtcbiAgICAgIChkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudFxuICAgICAgICA/IGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKClcbiAgICAgICAgOiBkb2N1bWVudC5ib2R5LnJlcXVlc3RGdWxsc2NyZWVuKCkpLmNhdGNoKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZShjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBzd2l0Y2ggKHZtLnNldHRpbmdzLmdlbmVyYWwudmlld1R5cGUudmFsdWUpIHtcbiAgICAgIGNhc2UgdWkuc2V0dGluZ3MuZ2VuZXJhbC5NYWluVHlwZS5NYXA6XG4gICAgICAgIHRoaXMubWFwLnJlZnJlc2goY29yZS5sZXZlbE5hbWUudmFsdWUpO1xuICAgICAgICB0aGlzLnVwZGF0ZU1hcChjb3JlLCB2bSwgbG9jYWxQbGF5ZXIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdWkuc2V0dGluZ3MuZ2VuZXJhbC5NYWluVHlwZS5SYWRhcjpcbiAgICAgICAgdGhpcy5yYWRhci5yZWZyZXNoKCk7XG4gICAgICAgIHRoaXMudXBkYXRlUmFkYXIoY29yZSwgdm0sIGxvY2FsUGxheWVyKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIFxuICBwcml2YXRlIHVwZGF0ZU1hcChjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5tYXAuc2hvd0l0ZW1zLnZhbHVlKVxuICAgICAgdGhpcy5tYXAucmVuZGVySXRlbXMoY29yZS5pdGVtTGlzdC52YWx1ZXMoKSwgdm0uc2V0dGluZ3MuaXRlbVNldCk7XG4gICAgaWYgKHZtLnNldHRpbmdzLmdlbmVyYWwubWFwLnNob3dQbGF5ZXJzLnZhbHVlICYmIGxvY2FsUGxheWVyKVxuICAgICAgdGhpcy5tYXAucmVuZGVyUGxheWVycyhsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpKTtcbiAgfVxuICBcbiAgcHJpdmF0ZSB1cGRhdGVSYWRhcihjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5yYWRhci5zaG93SXRlbXMudmFsdWUgJiYgbG9jYWxQbGF5ZXIpXG4gICAgICB0aGlzLnJhZGFyLnJlbmRlckl0ZW1zKGxvY2FsUGxheWVyLCBjb3JlLml0ZW1MaXN0LnZhbHVlcygpLCB2bS5zZXR0aW5ncy5pdGVtU2V0KTtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5yYWRhci5zaG93UGxheWVycy52YWx1ZSAmJiBsb2NhbFBsYXllcilcbiAgICAgIHRoaXMucmFkYXIucmVuZGVyTnBjcyhsb2NhbFBsYXllciwgY29yZS5ucGNMaXN0LnZhbHVlcygpKTtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5yYWRhci5zaG93UGxheWVycy52YWx1ZSAmJiBsb2NhbFBsYXllcilcbiAgICAgIHRoaXMucmFkYXIucmVuZGVyUGxheWVycyhsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpKTtcbiAgfVxuICBcbiAgcHJpdmF0ZSB1cGRhdGVSZXNlYXJjaChjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBpZiAodm0uc2V0dGluZ3MucmVzZWFyY2gucmVjb2lsLmVuYWJsZS52YWx1ZSAmJiBsb2NhbFBsYXllciAmJiB2bS5zZXR0aW5ncy5yZXNlYXJjaC5yZWNvaWwub3B0aW9ucylcbiAgICAgIHRoaXMucmVjb2lsLnVwZGF0ZShjb3JlLmJ1dHRvbkxpc3QsIGxvY2FsUGxheWVyLCB2bS5zZXR0aW5ncy5yZXNlYXJjaC5yZWNvaWwub3B0aW9ucyk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNlbnNlKGNvcmU6IGFwcC5jb3JlLkNvcmUsIHZtOiB1aS5NYWluVmlld01vZGVsLCBsb2NhbFBsYXllcj86IGFwcC5jb3JlLlBsYXllcikge1xuICAgIGNvbnN0IGl0ZW1zRm4gPSB2bS5zZXR0aW5ncy5nZW5lcmFsLnNlbnNlLmhpZ2hsaWdodEl0ZW1zLnZhbHVlXG4gICAgICA/IHRoaXMuc2Vuc2UudXBkYXRlSXRlbXMuYmluZCh0aGlzLnNlbnNlKVxuICAgICAgOiB0aGlzLnNlbnNlLnJlc2V0SXRlbXMuYmluZCh0aGlzLnNlbnNlKTtcbiAgICBjb25zdCBwbGF5ZXJzRm4gPSB2bS5zZXR0aW5ncy5nZW5lcmFsLnNlbnNlLmhpZ2hsaWdodFBsYXllcnMudmFsdWVcbiAgICAgID8gdGhpcy5zZW5zZS51cGRhdGVQbGF5ZXJzLmJpbmQodGhpcy5zZW5zZSlcbiAgICAgIDogdGhpcy5zZW5zZS5yZXNldFBsYXllcnMuYmluZCh0aGlzLnNlbnNlKTtcbiAgICBpZiAobG9jYWxQbGF5ZXIpIHtcbiAgICAgIGl0ZW1zRm4obG9jYWxQbGF5ZXIsIGNvcmUuaXRlbUxpc3QudmFsdWVzKCksIHZtLnNldHRpbmdzLml0ZW1TZXQpO1xuICAgICAgcGxheWVyc0ZuKGxvY2FsUGxheWVyLCBjb3JlLnBsYXllckxpc3QudmFsdWVzKCkpO1xuICAgIH1cbiAgfVxufVxuIl19