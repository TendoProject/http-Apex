"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Radar = void 0;
class Radar {
    constructor(canvas, maximumDistance = 200, numberOfRings = 8) {
        this.canvas = canvas;
        this.maximumDistance = maximumDistance;
        this.numberOfRings = numberOfRings;
        this.centerX = 0;
        this.centerY = 0;
        this.outerRadius = 0;
        this.context = canvas.getContext('2d');
    }
    refresh() {
        this.update();
        this.renderBackground();
        this.renderLines();
        this.renderRings();
    }
    renderItems(localPlayer, items, itemSet) {
        for (const item of items) {
            if (!itemSet.has(item.customScriptInt.value))
                continue;
            const position = this.calculatePosition(localPlayer, item.localOrigin);
            if (position) {
                this.context.beginPath();
                this.context.arc(position.x, position.y, this.outerRadius / 80, 0, Math.PI * 2);
                this.context.fillStyle = '#FFF';
                this.context.fill();
            }
        }
    }
    renderNpcs(localPlayer, npcs) {
        for (const npc of npcs) {
            const position = this.calculatePosition(localPlayer, npc.localOrigin);
            if (position) {
                this.context.beginPath();
                this.context.arc(position.x, position.y, this.outerRadius / 40, 0, Math.PI * 2);
                this.context.fillStyle = npc.createColor();
                this.context.fill();
            }
        }
    }
    renderPlayers(localPlayer, players) {
        for (const player of players) {
            if (!player.isValid || player === localPlayer)
                continue;
            const position = this.calculatePosition(localPlayer, player.localOrigin);
            if (position) {
                this.context.beginPath();
                this.context.arc(position.x, position.y, this.outerRadius / 40, 0, Math.PI * 2);
                this.context.fillStyle = player.createColor(localPlayer);
                this.context.fill();
            }
        }
    }
    calculatePosition(localPlayer, origin) {
        const dx = (localPlayer.localOrigin.value.x - origin.value.x) * 0.0254;
        const dy = (localPlayer.localOrigin.value.y - origin.value.y) * 0.0254;
        const r = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
        if (r < this.maximumDistance) {
            const s = this.outerRadius / this.maximumDistance;
            const a = Math.sign(dy) * Math.acos(dx / r) - localPlayer.viewAngle.value.y * Math.PI / 180;
            const x = this.centerX + Math.sin(a) * r * s;
            const y = this.centerY + Math.cos(a) * r * s;
            return { x, y };
        }
        else {
            return;
        }
    }
    renderBackground() {
        this.context.beginPath();
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.context.arc(this.centerX, this.centerY, this.outerRadius, 0, Math.PI * 2);
        this.context.fillStyle = '#000';
        this.context.fill();
    }
    renderLines() {
        this.context.strokeStyle = '#FFF';
        for (let i = 0; i < 8; i++) {
            const x = this.centerX + this.outerRadius * Math.cos(i * Math.PI * 0.25);
            const y = this.centerY + this.outerRadius * Math.sin(i * Math.PI * 0.25);
            this.context.beginPath();
            this.context.moveTo(this.centerX, this.centerY);
            this.context.lineTo(x, y);
            this.context.stroke();
        }
    }
    renderRings() {
        this.context.strokeStyle = '#FFF';
        for (let i = 1; i <= this.numberOfRings; i++) {
            this.context.beginPath();
            this.context.arc(this.centerX, this.centerY, this.outerRadius * i / this.numberOfRings, 0, Math.PI * 2);
            this.context.stroke();
        }
    }
    update() {
        this.centerX = this.canvas.width / 2;
        this.centerY = this.canvas.height / 2;
        this.outerRadius = (this.canvas.width > this.canvas.height ? this.canvas.height : this.canvas.width) / 2;
    }
}
exports.Radar = Radar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2ZlYXR1cmVzL1JhZGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLE1BQWEsS0FBSztJQU1oQixZQUNtQixNQUF5QixFQUN6QixrQkFBa0IsR0FBRyxFQUNyQixnQkFBZ0IsQ0FBQztRQUZqQixXQUFNLEdBQU4sTUFBTSxDQUFtQjtRQUN6QixvQkFBZSxHQUFmLGVBQWUsQ0FBTTtRQUNyQixrQkFBYSxHQUFiLGFBQWEsQ0FBSTtRQVA1QixZQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ1osWUFBTyxHQUFHLENBQUMsQ0FBQztRQUNaLGdCQUFXLEdBQUcsQ0FBQyxDQUFDO1FBTXRCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUUsQ0FBQztJQUMxQyxDQUFDO0lBRUQsT0FBTztRQUNMLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVELFdBQVcsQ0FBQyxXQUE0QixFQUFFLEtBQThCLEVBQUUsT0FBb0I7UUFDNUYsS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLLEVBQUU7WUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUM7Z0JBQUUsU0FBUztZQUN2RCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN2RSxJQUFJLFFBQVEsRUFBRTtnQkFDWixJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxR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LENBQUMsTUFBTSxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRU8sTUFBTTtRQUNaLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzNHLENBQUM7Q0FDRjtBQTNHRCxzQkEyR0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBhcHAgZnJvbSAnLic7XG5cbmV4cG9ydCBjbGFzcyBSYWRhciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuICBwcml2YXRlIGNlbnRlclggPSAwO1xuICBwcml2YXRlIGNlbnRlclkgPSAwO1xuICBwcml2YXRlIG91dGVyUmFkaXVzID0gMDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsXG4gICAgcHJpdmF0ZSByZWFkb25seSBtYXhpbXVtRGlzdGFuY2UgPSAyMDAsXG4gICAgcHJpdmF0ZSByZWFkb25seSBudW1iZXJPZlJpbmdzID0gOCkge1xuICAgIHRoaXMuY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpITtcbiAgfVxuXG4gIHJlZnJlc2goKSB7XG4gICAgdGhpcy51cGRhdGUoKTtcbiAgICB0aGlzLnJlbmRlckJhY2tncm91bmQoKTtcbiAgICB0aGlzLnJlbmRlckxpbmVzKCk7XG4gICAgdGhpcy5yZW5kZXJSaW5ncygpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMobG9jYWxQbGF5ZXI6IGFwcC5jb3JlLlBsYXllciwgaXRlbXM6IEl0ZXJhYmxlPGFwcC5jb3JlLkl0ZW0+LCBpdGVtU2V0OiBTZXQ8bnVtYmVyPikge1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgaWYgKCFpdGVtU2V0LmhhcyhpdGVtLmN1c3RvbVNjcmlwdEludC52YWx1ZSkpIGNvbnRpbnVlO1xuICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmNhbGN1bGF0ZVBvc2l0aW9uKGxvY2FsUGxheWVyLCBpdGVtLmxvY2FsT3JpZ2luKTtcbiAgICAgIGlmIChwb3NpdGlvbikge1xuICAgICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMuY29udGV4dC5hcmMocG9zaXRpb24ueCwgcG9zaXRpb24ueSwgdGhpcy5vdXRlclJhZGl1cyAvIDgwLCAwLCBNYXRoLlBJICogMik7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSAnI0ZGRic7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICByZW5kZXJOcGNzKGxvY2FsUGxheWVyOiBhcHAuY29yZS5QbGF5ZXIsIG5wY3M6IEl0ZXJhYmxlPGFwcC5jb3JlLk5QQz4pIHtcbiAgICBmb3IgKGNvbnN0IG5wYyBvZiBucGNzKSB7XG4gICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuY2FsY3VsYXRlUG9zaXRpb24obG9jYWxQbGF5ZXIsIG5wYy5sb2NhbE9yaWdpbik7XG4gICAgICBpZiAocG9zaXRpb24pIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICB0aGlzLmNvbnRleHQuYXJjKHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHRoaXMub3V0ZXJSYWRpdXMgLyA0MCwgMCwgTWF0aC5QSSAqIDIpO1xuICAgICAgICB0aGlzLmNvbnRleHQuZmlsbFN0eWxlID0gbnBjLmNyZWF0ZUNvbG9yKCk7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyUGxheWVycyhsb2NhbFBsYXllcjogYXBwLmNvcmUuUGxheWVyLCBwbGF5ZXJzOiBJdGVyYWJsZTxhcHAuY29yZS5QbGF5ZXI+KSB7XG4gICAgZm9yIChjb25zdCBwbGF5ZXIgb2YgcGxheWVycykge1xuICAgICAgaWYgKCFwbGF5ZXIuaXNWYWxpZCB8fCBwbGF5ZXIgPT09IGxvY2FsUGxheWVyKSBjb250aW51ZTtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5jYWxjdWxhdGVQb3NpdGlvbihsb2NhbFBsYXllciwgcGxheWVyLmxvY2FsT3JpZ2luKTtcbiAgICAgIGlmIChwb3NpdGlvbikge1xuICAgICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMuY29udGV4dC5hcmMocG9zaXRpb24ueCwgcG9zaXRpb24ueSwgdGhpcy5vdXRlclJhZGl1cyAvIDQwLCAwLCBNYXRoLlBJICogMik7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSBwbGF5ZXIuY3JlYXRlQ29sb3IobG9jYWxQbGF5ZXIpO1xuICAgICAgICB0aGlzLmNvbnRleHQuZmlsbCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlUG9zaXRpb24obG9jYWxQbGF5ZXI6IGFwcC5jb3JlLlBsYXllciwgb3JpZ2luOiBhcHAuY29yZS5WZWN0b3IpIHtcbiAgICBjb25zdCBkeCA9IChsb2NhbFBsYXllci5sb2NhbE9yaWdpbi52YWx1ZS54IC0gb3JpZ2luLnZhbHVlLngpICogMC4wMjU0O1xuICAgIGNvbnN0IGR5ID0gKGxvY2FsUGxheWVyLmxvY2FsT3JpZ2luLnZhbHVlLnkgLSBvcmlnaW4udmFsdWUueSkgKiAwLjAyNTQ7XG4gICAgY29uc3QgciA9IE1hdGguc3FydChNYXRoLnBvdyhkeCwgMikgKyBNYXRoLnBvdyhkeSwgMikpO1xuICAgIGlmIChyIDwgdGhpcy5tYXhpbXVtRGlzdGFuY2UpIHtcbiAgICAgIGNvbnN0IHMgPSB0aGlzLm91dGVyUmFkaXVzIC8gdGhpcy5tYXhpbXVtRGlzdGFuY2U7XG4gICAgICBjb25zdCBhID0gTWF0aC5zaWduKGR5KSAqIE1hdGguYWNvcyhkeCAvIHIpIC0gbG9jYWxQbGF5ZXIudmlld0FuZ2xlLnZhbHVlLnkgKiBNYXRoLlBJIC8gMTgwO1xuICAgICAgY29uc3QgeCA9IHRoaXMuY2VudGVyWCArIE1hdGguc2luKGEpICogciAqIHM7XG4gICAgICBjb25zdCB5ID0gdGhpcy5jZW50ZXJZICsgTWF0aC5jb3MoYSkgKiByICogcztcbiAgICAgIHJldHVybiB7eCwgeX07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckJhY2tncm91bmQoKSB7XG4gICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5jb250ZXh0LmFyYyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5vdXRlclJhZGl1cywgMCwgTWF0aC5QSSAqIDIpO1xuICAgIHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSAnIzAwMCc7XG4gICAgdGhpcy5jb250ZXh0LmZpbGwoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTGluZXMoKSB7XG4gICAgdGhpcy5jb250ZXh0LnN0cm9rZVN0eWxlID0gJyNGRkYnO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XG4gICAgICBjb25zdCB4ID0gdGhpcy5jZW50ZXJYICsgdGhpcy5vdXRlclJhZGl1cyAqIE1hdGguY29zKGkgKiBNYXRoLlBJICogMC4yNSk7XG4gICAgICBjb25zdCB5ID0gdGhpcy5jZW50ZXJZICsgdGhpcy5vdXRlclJhZGl1cyAqIE1hdGguc2luKGkgKiBNYXRoLlBJICogMC4yNSk7XG4gICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICB0aGlzLmNvbnRleHQubW92ZVRvKHRoaXMuY2VudGVyWCwgdGhpcy5jZW50ZXJZKTtcbiAgICAgIHRoaXMuY29udGV4dC5saW5lVG8oeCwgeSk7XG4gICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJSaW5ncygpIHtcbiAgICB0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnI0ZGRic7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGhpcy5udW1iZXJPZlJpbmdzOyBpKyspIHtcbiAgICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgIHRoaXMuY29udGV4dC5hcmModGhpcy5jZW50ZXJYLCB0aGlzLmNlbnRlclksIHRoaXMub3V0ZXJSYWRpdXMgKiBpIC8gdGhpcy5udW1iZXJPZlJpbmdzLCAwLCBNYXRoLlBJICogMik7XG4gICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGUoKSB7XG4gICAgdGhpcy5jZW50ZXJYID0gdGhpcy5jYW52YXMud2lkdGggLyAyO1xuICAgIHRoaXMuY2VudGVyWSA9IHRoaXMuY2FudmFzLmhlaWdodCAvIDI7XG4gICAgdGhpcy5vdXRlclJhZGl1cyA9ICh0aGlzLmNhbnZhcy53aWR0aCA+IHRoaXMuY2FudmFzLmhlaWdodCA/IHRoaXMuY2FudmFzLmhlaWdodCA6IHRoaXMuY2FudmFzLndpZHRoKSAvIDI7XG4gIH1cbn1cbiJdfQ==