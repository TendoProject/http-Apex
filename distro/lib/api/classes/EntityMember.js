"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EntityMember = void 0;
const app = require("..");
class EntityMember {
    constructor(offset, interval, size) {
        this.buffer = new DataView(new ArrayBuffer(size));
        this.interval = interval;
        this.offset = offset;
    }
    receive(packet) {
        if (packet instanceof app.EntityUpdateEntityMember) {
            this.receiveUpdate(packet);
        }
        else {
            this.receiveSync(packet);
        }
    }
    update(syncId) {
        if (!this.send)
            return;
        const packet = new app.EntityChangeMember(this.offset, this.buffer, this.deltas);
        this.deltas = undefined;
        this.send = false;
        this.syncId = syncId;
        return packet;
    }
    receiveUpdate(packet) {
        if (typeof this.syncId !== 'undefined')
            return;
        if (packet.buffer.byteLength !== this.buffer.byteLength)
            return;
        for (let i = 0; i < packet.buffer.byteLength; i++)
            this.buffer.setUint8(i, packet.buffer.getUint8(i));
    }
    receiveSync(packet) {
        if (this.syncId !== packet.id)
            return;
        this.syncId = undefined;
    }
}
exports.EntityMember = EntityMember;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5TWVtYmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi9hcGkvY2xhc3Nlcy9FbnRpdHlNZW1iZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMEJBQTBCO0FBRTFCLE1BQWEsWUFBWTtJQVF2QixZQUFZLE1BQWMsRUFBRSxRQUFnQixFQUFFLElBQVk7UUFDeEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLFFBQVEsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxPQUFPLENBQUMsTUFBb0Q7UUFDMUQsSUFBSSxNQUFNLFlBQVksR0FBRyxDQUFDLHdCQUF3QixFQUFFO1lBQ2xELElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDNUI7YUFBTTtZQUNMLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDMUI7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQWM7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJO1lBQUUsT0FBTztRQUN2QixNQUFNLE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pGLElBQUksQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFTyxhQUFhLENBQUMsTUFBb0M7UUFDeEQsSUFBSSxPQUFPLElBQUksQ0FBQyxNQUFNLEtBQUssV0FBVztZQUFFLE9BQU87UUFDL0MsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVU7WUFBRSxPQUFPO1FBQ2hFLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUU7WUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4RyxDQUFDO0lBRU8sV0FBVyxDQUFDLE1BQXFCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsRUFBRTtZQUFFLE9BQU87UUFDdEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7SUFDMUIsQ0FBQztDQUNGO0FBekNELG9DQXlDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcCBmcm9tICcuLic7XG5cbmV4cG9ydCBjbGFzcyBFbnRpdHlNZW1iZXIge1xuICByZWFkb25seSBidWZmZXI6IERhdGFWaWV3O1xuICByZWFkb25seSBpbnRlcnZhbDogbnVtYmVyO1xuICByZWFkb25seSBvZmZzZXQ6IG51bWJlcjtcbiAgZGVsdGFzPzogQXJyYXk8YXBwLkVudGl0eUNoYW5nZU1lbWJlckRlbHRhPjtcbiAgc2VuZD86IGJvb2xlYW47XG4gIHN5bmNJZD86IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihvZmZzZXQ6IG51bWJlciwgaW50ZXJ2YWw6IG51bWJlciwgc2l6ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5idWZmZXIgPSBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKHNpemUpKTtcbiAgICB0aGlzLmludGVydmFsID0gaW50ZXJ2YWw7XG4gICAgdGhpcy5vZmZzZXQgPSBvZmZzZXQ7XG4gIH1cblxuICByZWNlaXZlKHBhY2tldDogYXBwLkJhc2ljU3luYyB8IGFwcC5FbnRpdHlVcGRhdGVFbnRpdHlNZW1iZXIpIHtcbiAgICBpZiAocGFja2V0IGluc3RhbmNlb2YgYXBwLkVudGl0eVVwZGF0ZUVudGl0eU1lbWJlcikge1xuICAgICAgdGhpcy5yZWNlaXZlVXBkYXRlKHBhY2tldCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVjZWl2ZVN5bmMocGFja2V0KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGUoc3luY0lkOiBudW1iZXIpIHtcbiAgICBpZiAoIXRoaXMuc2VuZCkgcmV0dXJuO1xuICAgIGNvbnN0IHBhY2tldCA9IG5ldyBhcHAuRW50aXR5Q2hhbmdlTWVtYmVyKHRoaXMub2Zmc2V0LCB0aGlzLmJ1ZmZlciwgdGhpcy5kZWx0YXMpO1xuICAgIHRoaXMuZGVsdGFzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VuZCA9IGZhbHNlO1xuICAgIHRoaXMuc3luY0lkID0gc3luY0lkO1xuICAgIHJldHVybiBwYWNrZXQ7XG4gIH1cblxuICBwcml2YXRlIHJlY2VpdmVVcGRhdGUocGFja2V0OiBhcHAuRW50aXR5VXBkYXRlRW50aXR5TWVtYmVyKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLnN5bmNJZCAhPT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcbiAgICBpZiAocGFja2V0LmJ1ZmZlci5ieXRlTGVuZ3RoICE9PSB0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoKSByZXR1cm47XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWNrZXQuYnVmZmVyLmJ5dGVMZW5ndGg7IGkrKykgdGhpcy5idWZmZXIuc2V0VWludDgoaSwgcGFja2V0LmJ1ZmZlci5nZXRVaW50OChpKSk7XG4gIH1cblxuICBwcml2YXRlIHJlY2VpdmVTeW5jKHBhY2tldDogYXBwLkJhc2ljU3luYykge1xuICAgIGlmICh0aGlzLnN5bmNJZCAhPT0gcGFja2V0LmlkKSByZXR1cm47XG4gICAgdGhpcy5zeW5jSWQgPSB1bmRlZmluZWQ7XG4gIH1cbn1cbiJdfQ==